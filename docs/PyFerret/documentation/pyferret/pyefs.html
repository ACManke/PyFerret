 
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML+RDFa 1.1//EN">
<html lang="en" dir="ltr" version="HTML+RDFa 1.1"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/terms/"
xmlns:foaf="http://xmlns.com/foaf/0.1/"
xmlns:og="http://ogp.me/ns#"
xmlns:rdfs="https://www.w3.org/2000/01/rdf-schema#"
xmlns:sioc="http://rdfs.org/sioc/ns#"
xmlns:sioct="http://rdfs.org/sioc/types#"
xmlns:skos="https://www.w3.org/2004/02/skos/core#"
xmlns:xsd="https://www.w3.org/2001/XMLSchema#"
xmlns:schema="http://schema.org/">
<head profile="https://www.w3.org/1999/xhtml/vocab">
<title>Ferret external functions in Python - Ferret/PyFerret Documentation</title>

<link rel="stylesheet" href="../../modules/system/system.base.css">
<link rel="stylesheet" href="../../modules/system/system.menus.css">
<link rel="stylesheet" href="../../modules/system/system.messages.css">
<link rel="stylesheet" href="../../modules/system/system.theme.css">

<link rel="stylesheet" href="../../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.core.min.css">
<link rel="stylesheet" href="../../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.theme.min.css">
<link rel="stylesheet" href="../../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.menu.min.css">
<link rel="stylesheet" href="../../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.autocomplete.min.css">

<link rel="stylesheet" href="../../sites/all/modules/calendar/css/calendar_multiday.css">
<link rel="stylesheet" href="../../modules/field/theme/field.css">
<link rel="stylesheet" href="../../sites/all/modules/scald/modules/fields/mee/css/editor-global.css">
<link rel="stylesheet" href="../../modules/node/node.css">
<link rel="stylesheet" href="../../sites/all/modules/scald_file/scald_file.css">
<link rel="stylesheet" href="../../modules/search/search.css">
<link rel="stylesheet" href="../../modules/user/user.css">
<link rel="stylesheet" href="../../sites/all/modules/views/css/views.css">
<link rel="stylesheet" href="../../sites/all/modules/ckeditor/css/ckeditor.css">

<link rel="stylesheet" href="../../sites/all/modules/ctools/css/ctools.css">
<link rel="stylesheet" href="../../sites/all/modules/custom_search/custom_search.css">
<link rel="stylesheet" href="../../sites/all/modules/search_autocomplete/css/themes/minimal.css">
<link rel="stylesheet" href="../../sites/all/libraries/superfish/css/superfish.css">
<link rel="stylesheet" href="../../sites/all/libraries/superfish/css/superfish-smallscreen.css">
<link rel="stylesheet" href="../../sites/all/libraries/superfish/css/superfish-vertical.css">

<link rel="stylesheet" href="../../sites/all/themes/pacific_marine/css/ckeditor_custom.css">

<link rel="stylesheet" href="../../sites/all/themes/omega/alpha/css/alpha-reset.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/alpha/css/alpha-mobile.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/alpha/css/alpha-alpha.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/omega/css/formalize.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/omega/css/omega-text.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/omega/css/omega-branding.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/omega/css/omega-menu.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/omega/css/omega-forms.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/omega/css/omega-visuals.css">
<link rel="stylesheet" href="../../sites/all/themes/pacific_marine/css/global.css">



<link rel="stylesheet" href="../../sites/all/themes/pacific_marine/css/pacific-marine-alpha-default.css">
<link rel="stylesheet" href="../../sites/all/themes/pacific_marine/css/pacific-marine-alpha-default-wide.css">
<link rel="stylesheet" href="../../sites/all/themes/omega/alpha/css/grid/alpha_default/wide/alpha-default-wide-12.css">


</head>
<body class="html not-front not-logged-in page-node page-node- page-node-555 node-type-documentation-page context-documentation">
  <div id="body-bg-top"></div>
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div class="page clearfix" id="page">
      <header id="section-header" class="section section-header">
  <div id="zone-header-wrapper" class="zone-wrapper zone-header-wrapper clearfix">  
  <div id="zone-header" class="zone zone-header clearfix container-12">
    <div class="grid-7 region region-branding" id="region-branding">
  <div class="region-inner region-branding-inner">
        <div class="branding-data clearfix">
            <div class="logo-img">
        <a href="../../index.html" rel="home" title=""><img src="../../sites/all/themes/pacific_marine/images/ferret-banner.png" alt="" id="logo" /></a>
		</div>
                </div>
          </div>
</div><div class="grid-5 region region-header-first" id="region-header-first">
  <div class="region-inner region-header-first-inner">
    <div class="block block-block block-4 block-block-4 odd block-without-title" id="block-block-4">
  <div class="block-inner clearfix">

  </div>
</div>
  </div>
</div>  </div>
</div>  </div>
</div><div id="zone-menu-wrapper" class="zone-wrapper zone-menu-wrapper clearfix">  
  <div id="zone-menu" class="zone zone-menu clearfix container-12">
    <div class="grid-12 region region-menu" id="region-menu">
  <div class="region-inner region-menu-inner">
        <div class="block block-system block-menu block-main-menu block-system-main-menu odd block-without-title" id="block-system-main-menu">
  <div class="block-inner clearfix">
                
    <div class="content clearfix">
      <ul class="menu">
	  <li class="first expanded"><a href="../../index.html">Home</a></li>
<li class="leaf"><a href="../ferret-documentation.html">Documentation</a></li>
<li class="leaf"><a href="../../faq/ferret-faqs.html">FAQ</a></li>
<li class="collapsed"><a href="downloads.html">Downloads</a></li>
<li class="collapsed"><a href="../pyferret-support.html">Support</a></li>
</ul>    </div>
  </div>
</div>  </div>
</div>
  </div>
</div></header> 
<section id="section-content" class="section section-content">
<div id="zone-preface-wrapper" class="zone-wrapper zone-preface-wrapper clearfix">  
<div id="zone-preface" class="zone zone-preface clearfix equal-height-container container-12">
<div class="grid-3 region region-preface-first equal-height-element" id="region-preface-first">
<div class="region-inner region-preface-first-inner">
</div>
</div><div class="grid-9 region region-preface-second equal-height-element" id="region-preface-second">
<div class="region-inner region-preface-second-inner">
</div>
</div>  </div>
</div><div id="zone-content-wrapper" class="zone-wrapper zone-content-wrapper clearfix sidebar">  
<div id="zone-content" class="zone zone-content clearfix equal-height-container container-12">    

        <aside class="grid-3 region region-sidebar-first equal-height-element" id="region-sidebar-first">
  <div class="region-inner region-sidebar-first-inner">
    <div class="block block-superfish block-1 block-superfish-1 odd block-without-title" id="block-superfish-1">
  <div class="block-inner clearfix">
                
    <div class="content clearfix">
      <!-- start -->
      <ul  id="superfish-1" class="menu sf-menu sf-main-menu sf-vertical sf-style-none sf-total-items-8 sf-parent-items-4 sf-single-items-4"><li id="menu-1620-1" class="first odd sf-item-1 sf-depth-2 sf-no-children"><a href="../version-763-release-notes.html" class="sf-depth-2">Current Release Notes</a></li>
<li id="menu-1170-1" class="active-trail middle even sf-item-2 sf-depth-2 sf-total-children-17 sf-parent-children-15 sf-single-children-2 menuparent">
<a href="../users-guide/users-guide.html" class="sf-depth-2 menuparent">Ferret Users Guide</a>
</li>
<li id="menu-1336-1" class="middle odd sf-item-3 sf-depth-2 sf-no-children"><a href="../all-release-notes.html" class="sf-depth-2">Previous Release Notes</a></li>
<li id="menu-1339-1" class="middle even sf-item-4 sf-depth-2 sf-total-children-15 sf-parent-children-1 sf-single-children-14 menuparent"><a href="../ferret-tutorials.html" class="sf-depth-2 menuparent">Tutorials and Demos</a></li>

<li id="menu-1333-1" class="middle odd sf-item-5 sf-depth-2 sf-total-children-13 sf-parent-children-1 sf-single-children-12 menuparent"><a href="../pyferret.html" class="sf-depth-2 menuparent">PyFerret</a>
</li>

<li id="menu-1147-1" class="middle even sf-item-6 sf-depth-2 sf-total-children-3 sf-parent-children-0 sf-single-children-3 menuparent"><a href="../opendap/opendap-usage-in-ferret.html" class="sf-depth-2 menuparent">OPeNDAP</a></li>


<!-- <li id="menu-1592-1" class="middle odd sf-item-7 sf-depth-2 sf-no-children"><a href="../ferret-publications.html" class="sf-depth-2">Ferret Publications</a></li>
<li id="menu-1389-1" class="last even sf-item-8 sf-depth-2 sf-no-children"><a href="../acknowledging-ferret.html" class="sf-depth-2">Acknowledging Ferret</a></li> -->  
</ul>  <!-- end -->    </div>
  </div>
</div>  </div>
</aside><div class="grid-9 region region-content equal-height-element" id="region-content">
  <div class="region-inner region-content-inner">
<a id="main-content"></a>
<h1 class="title" id="page-title">Ferret external functions in Python</h1>
<div class="block block-system block-main block-system-main odd block-without-title" id="block-system-main">
<div class="block-inner clearfix">
 
<div class="content clearfix">
<article about="/Ferret/documentation/pyferret/pyefs" typeof="sioc:Item foaf:Document" class="node node-documentation-page node-promoted node-published node-not-sticky author-kobrien odd clearfix" id="node-documentation-page-363">


 
<div class="field field-name-field-page-description field-type-text field-label-hidden">
<div class="field-items">
<div class="field-item even" property="schema:description">How to create a Ferret external function written in Python</div>
</div>
</div>

<div class="content clearfix">
 
<div class="field field-name-body field-type-text-with-summary field-label-hidden">
<div class="field-items">
<div class="field-item even" property="content:encoded"><p><a href="pyferret-python-objects.html">Previous</a> <a href="fortranefs.html">Next</a></p>
<p>Ferret external functions written in Python (PyEFs) are simply Python scripts that define a couple of required functions, which will be discussed below. This script is placed in a directory where Python will be able to find it. This can be the directory you are working in, a directory that is listed in the environment variable <i>PYTHONPATH</i> (such as <i>$FER_DIR/lib/python2.6/site-packages</i> for Python 2.6 using the default <i>pyferret</i> script) or it can be one of the standard directories searche                                                                                                                                                                                                                                                
<p> </p>
<p>The Ferret command <i>DEFINE PYFUNCTION</i> tells PyFerret to find and import the indicated Python script for use as a Ferret external function. From that point on in the session, this Ferret external function will be available for you to use. Unlike traditional Ferret external functions written in Python, there is no automatic scanning and importing of PyEFs. If you wish to always import a given PyEF, you can add the <i>DEFINE PYFUNCTION</i> command in your <i>$HOME/.ferret</i> Ferret start-up file.</p>
<p>A PyEF requires the two function <a href="#PYEFS_FERRET_INIT"><i>ferret_init</i></a> and <a href="#PYEFS_FERRET_COMPUTE"><i>ferret_compute</i></a> to be defined in the Python script being used. If a new axis is used in the result array (referred to as a <i>grid-changing function</i> in Ferret), one of the functions <a href="#PYEFS_FERRET_CUSTOM_AXES"><i>ferret_custom_axes</i></a> or <a href="#PYEFS_FERRET_RESULT_LIMITS"><i>ferret_result_limits</i></a> must also be defined to describe the custom or abstra                                                                                                                         
<p>First shown is a very simple Python script meeting the minimal requirements for a PyEF. Then a somewhat more complicated PyEF is shown in the <a href="#PYEFS_GRID_CHANGING_EXAMPLE">grid-changing PyEF</a> section.</p>
<h3>A simple PyEF</h3>
<p>The following is a minimal Python script for a very simple PyEF.</p>
<pre>
'''
Example Ferret external function written in Python whose result array has values
that are twice that of the argument array, where they defined, and twenty elsewhere.
'''
import numpy
import pyferret
 
def ferret_init(id):
'''Creates and returns the initialization dictionary for this PyEF'''
initdict = { "numargs": 1, "descript": "Returns 2 * A where A is defined, and 20.0 elsewhere" }
return initdict
 
def ferret_compute(id, result, result_bad_flag, inputs, input_bad_flags):
'''Performs the computation for this PyEF'''
badmask = ( numpy.fabs(inputs[pyferret.ARG1] - input_bad_flags[pyferret.ARG1]) &lt; 1.0E-5 )
goodmask = numpy.logical_not(badmask)
result[badmask] = 20.0
result[goodmask] = 2.0 * inputs[pyferret.ARG1][goodmask]</pre><p>The <i>ferret_init</i> function returns a dictionary that defines properties of the PyEF. At a minimum, the key <i>"numargs"</i>, whose value is the number of arguments expected by the function, and the key <i>"descript"</i>, whose value is a function description shown to the user, must be defined in the dictionary. A number of other key:value pairs can be given customized the function further, and are described in the <a href="#PYEFS_FERRET_I                                                                                                                                                                                                                                                                                                                                                                                                       
<p>The <i>ferret_compute</i> function assigns the provided NumPy array <i>result</i> from the data provided in the list of input argument NumPy arrays <i>inputs</i>. The missing value to use for the result is <i>result_bad_flag</i> (which is a single-element NumPy array), and the missing values for each of the input argument arrays is <i>input_bad_flags</i>. In this trivial example, NumPy logical arrays are created to identify array locations where the (first, and only) argument data is missing and where da                                                                                                                                                                                        
<p>In a Ferret session in PyFerret, one can then use this script, saved as twiceortwenty.py, as a PyEF as follows:</p>
<pre>
! Create the PyEF function TWTW using the Python script twiceortwenty.py
def pyfunc /name=twtw twiceortwenty
 
! The following description was created from the dictionary of information
! returned by the ferret_init function in the twiceortwenty.py script.
! The default argument names are A, B, ...
show func twtw
TWTW(A)
Returns 2 * A where A is defined, and 20.0 elsewhere
 
! Use the function and plot the results
use coads_climatology
let twtwsst = twtw(sst)
 
! Plot some of the data, using the system's arial font for text,
! and save as a small PNG image.
set text /font=arial
shade twtwsst[Y=65S:65N,T=17-MAR]
frame /file=twtwsst.png /xpixels=600</pre><p>The following image is what was saved from the above:<br /><img class="image-inline" src="../../sites/default/files/images/documentation/pyferret/pyferret-images/twtwsst.png" /></p>
<p>
<a name="PYEFS_GRID_CHANGING_EXAMPLE" id="PYEFS_GRID_CHANGING_EXAMPLE"></a></p>
<h3>A grid-changing PyEF</h3>
<p>The following example shows a somewhat more complicated PyEF in which the fourth axis of the result is a frequency axis instead of the time axis given in the argument.</p>
<pre>
'''
FFT of a real 4D space-time grid to give a 4D space-frequency grid.
The results are returned in a single array, as (freq[i].real, freq[i].imag)
pairs of the non-negative frequencies. Uses a custom axis for the frequencies.
'''
import numpy
import numpy.fft as fft
import pyferret
 
def ferret_init(id):
'''Creates and returns the initialization dictionary for this PyEF'''
retdict = { "numargs": 1,
"descript": "FFT of X,Y,Z,T to return X,Y,Z,(F.real,F.imag) of non-neg freqs",
"axes": (pyferret.AXIS_IMPLIED_BY_ARGS, pyferret.AXIS_IMPLIED_BY_ARGS,
pyferret.AXIS_IMPLIED_BY_ARGS, pyferret.AXIS_CUSTOM),
"argnames": ("A",),
"argdescripts": ("X,Y,Z,T data with a regular bounded time axis",),
"influences": ((True,True,True,False),),
}
return retdict</pre><p>Again, the <a href="#PYEFS_FERRET_INIT"><i>ferret_init</i></a> function returns a dictionary that defines properties of the PyEF. In addition to providing the expected number of arguments with the <i>"numargs"</i> key and a function description with the <i>"descript"</i> key, the source of the result axes are given by the <i>"axes"</i> key, the argument names are explicitly named by the <i>"argnames"</i> key, and description of each argument is given with the <i>"argdescripts"</i> key                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
<p>Continuing the above Python script, the <i>ferret_custom_axes</i> function is defined:</p>
<pre>
def ferret_custom_axes(id):
'''Defines the frequency axis (derived from the time axis)'''
# Get the number of steps along the time axis of the first argument
# and check for some common errors
axis_info = pyferret.get_axis_info(id, pyferret.ARG1, pyferret.T_AXIS)
ntime = axis_info.get("size", -1)
if ntime &lt; 0:
raise ValueError("The time axis is not bounded (not pre-defined)")
if ntime &lt; 4:
raise ValueError("Unexpectedly small number of time steps (
regular = axis_info.get("regular", False)
if not regular:
raise ValueError("The time axis is not a regularly-spaced axis")
# The result will have (ntime // 2 + 1) complex values
# (only the non-negative frequencies are returned).
# The values are returned as the real (at 0.0, 1.0, 2.0, ...),
# then imaginary (at 0.5, 1.5, 2.5, ...) components.
low = 0.0
high = (ntime // 2) + 0.5
delta = 0.5
unit_name = "freqnum"
is_modulo = False
# The first three axes are inherited from the argument(s)
# so None is given for their descriptions.
#
# The fourth axis goes from low to high, with increments
# of delta, and units given by unit_name. It is not a
# modulo axis since is_modulo is False.
return (None, None, None, (low,high,delta,unit_name,is_modulo))</pre><p>The <i>ferret_custom_axes</i> function defines all axes that were designated as <i>AXIS_CUSTOM</i> by <i>ferret_init</i>. In this case, only the fourth axis needs to be defined. The <i>get_axis_info</i> function is used to obtain a dictionary of information about the <i>T_AXIS</i> of <i>ARG1</i>, primarily to get the number of time steps in the argument. The function returns a four-tuple of values, one element for each axis of the resul                                                                                                                                                                                                                                                                                                               
<p>Now that the result axes are all defined, the <a href="#PYEFS_FERRET_COMPUTE"><i>ferret_compute</i></a> function can be defined. Continuing the above Python script:</p>
<pre>
def ferret_compute(id, result, result_bad_flag, inputs, input_bad_flags):
''' Assigns result with the fft, as (real,imaginary) pairs, of the first inputs array along the time axis. '''
ntime = inputs[pyferret.ARG1].shape[pyferret.T_AXIS]
nfreq = (ntime // 2) + 1
# find locations that have values at every time step
inpdefd = ( numpy.fabs(inputs[pyferret.ARG1] - input_bad_flags[pyferret.ARG1]) &gt;= 1.0E-5 )
defdmask = numpy.logical_and.reduce(inpdefd, axis=pyferret.T_AXIS)
for t in xrange(ntime):
inpdefd[:,:,:,t] = defdmask
# convert to space-time (a 2-D array), eliminating locations with missing time steps
spacetime = inputs[pyferret.ARG1][inpdefd].reshape((-1, ntime))
# do the FFT along the time axis (the second axis of spacetime)
spacefreqs = fft.rfft(spacetime, axis=1)
if spacefreqs.shape[1] != nfreq:
raise ValueError("Unexpected shape of the frequencies returned from rfft:
# fill results with the real and imaginary parts of the frequencies
for f in xrange(nfreq):
result[:,:,:,2*f][defdmask] = spacefreqs[:,f].real
result[:,:,:,2*f+1][defdmask] = spacefreqs[:,f].imag
# assign the result bad value to positions not assigned
undefdmask = numpy.logical_not(defdmask)
for f in xrange(2*nfreq):
result[:,:,:,f][undefdmask] = result_bad_flag[0]</pre><p>After removing any locations with missing time steps, this function performs the Fast Fourier Transform of the real data by using the rfft function in the numpy.fft module. The resulting frequencies are then assigned to the appropriate locations in the result array, and unassigned locations are assigned the result's missing value.</p>
<p>This completes the Python script, which if saved as pyfft.py, can be used in a Ferret session in PyFerret as follows:</p>
<pre>
! define the PyEF pyfft using the pyfft.py script
def pyfunc pyfft
 
 
! the function and argument descriptions are generated
! from the information returned in ferret_init
show func pyfft
PYFFT(A)
FFT of X,Y,Z,T to return X,Y,Z,(F.real,F.imag) of non-neg freqs
A: X,Y,Z,T data with a regular bounded time axis
 
! Define an ordinary latitude axis on Y
def axis /y=90S:90N:1 stlat
 
! Create a regular time axis over a twenty-year period
def axis /t=1-jan-1990:1-jan-2010:1 /unit=day /t0=1-jan-1990 /edges sttime
 
! Synthesize some temperature data with using cosine functions of time
let /title="SYNTEMPS" syntemps = \ 27 * cos(Y[gy=stlat] * 3.141592653 / 180.0) \
- 0.05 * Y[gy=stlat] * cos(T[gt=sttime] * 2 * 3.14159265 / 365.2425) \
+ 0.03 * (abs(Y[gy=stlat]) - 90.0) * (cos(T[gt=sttime] * 2 * 3.141592653 / 365.2425))^2
show grid syntemps
 
......
 
! plot the synthesized temperatures
set text /font=arial
shade syntempsframe /file=syntemps.png /xpix=600 
 
! compute the frequencies from the synthetic tempartures
let /title="SYNFREQS" synfreqs = pyfft(syntemps)
 
! the Y axis of the result was inherited from syntemps,
! but the T axis is a new axes generated from the information
! returned by ferret_custom_axes
sh grid synfreqs
 
......
 
! in a new window plot the real parts of the first 61 frequencies at 60S on the left side of the page
set win 2
set view left
plot /vlimit=-4000:32000:4000 synfreqs[Y=60S,T=0.0:60.0:1.0]
 
! plot the real parts of the first 61 frequencies at 20N on the right side of the page
set view right
plot /vlimit=-4000:32000:4000 synfreqs[Y=20N,T=0.0:60.0:1.0]
 
! save the image
frame /file=synfreqs.png /xpix=600</pre><p>The synthesized temperatures plot show the sinusoidal behavior with respect to both latitude and time:<br /><img class="image-inline" src="../../sites/default/files/images/documentation/pyferret/pyferret-images/syntemps.png" /></p>
<p>The frequencies plot show a strong zero-frequency (peaks are truncated in these plots) due to the baseline value that does not depend on temperature (the <i>cos(Y)</i> term), then an annual frequency that varies with latitude, vanishing at the equator (the <i>Y * cos(T)</i> term, showing up at 20.0 for this 20-year collection of data), and finally a negative semiannual frequency that varies with latitude and is strongest at the equator (the <i>(|Y| - 90) * cos¬≤(T)</i> term, showing up at 40.0):<br />                                                                                                                             
<p>
<a name="PYEFS_FERRET_INIT" id="PYEFS_FERRET_INIT"></a></p>
<h3>ferret_init</h3>
<p>The ferret_init function of a PyEF has the following signature:</p>
<dl><dt>ferret_init(id)</dt>
</dl><p> </p>
<p>The argument of the the function is:</p>
<p> </p>
<dl><dt>id</dt>
<dd>Ferret's identification number for this external function</dd>
</dl><p> </p>
<p>This functions returns a dictionary defining the following keys:</p>
<p> </p>
<dl><dt>"numargs"</dt>
<dd>the number of input arguments (referred to a <i>N</i> below), an integer value from one to nine (required)</dd>
<dt>"descript"</dt>
<dd>a string description of the function (required)</dd>
<dt>"restype"</dt>
<dd>the type of the result (optional; the default is <i>FLOAT_ARRAY</i>.This result type value is one of:
<dl><dt>FLOAT_ARRAY</dt>
<dd>an array of floating-point values</dd>
<dt>STRING_ARRAY</dt>
<dd>an array of string values</dd>
</dl></dd>
<dt>"resstrlen"</dt>
<dd>the maximum length of the strings if the result type is an array of strings(optional; the default is 128)</dd>
<dt>"axes"</dt>
<dd>six-tuple (X,Y,Z,T,E,F) axis definitions for the grid of the result array(optional; the default is a six-tuple of <i>AXIS_IMPLIED_BY_ARGS</i>). These axis definition values are one of:
<dl><dt>AXIS_IMPLIED_BY_ARGS</dt>
<dd>result axis is the same as the corresponding axis in one or more arguments (default)</dd>
<dt>AXIS_ABSTRACT</dt>
<dd>result axis is an indexed axis whose limits are obtained by calling <i>ferret_result_limits</i></dd>
<dt>AXIS_CUSTOM</dt>
<dd>result axis is a custom axis defined by calling <i>ferret_custom_axes</i></dd>
<dt>AXIS_DOES_NOT_EXIST</dt>
<dd>axis does not exist in (is normal to) the results</dd>
<dt>AXIS_REDUCED</dt>
<dd>axis is reduced to a single point in the result</dd>
</dl></dd>
<dt>"argnames"</dt>
<dd>an N-tuple of names for the input arguments (optional; the default is <i>('A', 'B', 'C', ...)</i>,an N-tuple of single capital letters)</dd>
<dt>"argdescripts"</dt>
<dd>an N-tuple of descriptions for the input arguments (optional; the default is an N of empty strings,thus giving no argument descriptions)</dd>
<dt>"argtypes"</dt>
<dd>an N-tuple of argument types (optional; the default is an N-tuple of <i>FLOAT_ARRAY</i>).These argument types are one of:
<dl><dt>FLOAT_ARRAY</dt>
<dd>an array of floating-point values</dd>
<dt>FLOAT_ONEVAL</dt>
<dd>a single floating-point value</dd>
<dt>STRING_ARRAY</dt>
<dd>an array of string values</dd>
<dt>STRING_ONEVAL</dt>
<dd>a single string value</dd>
</dl></dd>
<dt>"influences"</dt>
<dd>an N-tuple of six-tuples of booleans indicating whether each of the corresponding input argument's(X,Y,Z,T,E,F) axis influences the result grid's (X,Y,Z,T,E,F) axis (optional; the default is True for everyaxis of every argument). If None is given for an argument's six-tuple, then True is assumes for everyaxis of that argument.<br />
	NOTE: If the <i>"influences"</i> value for an axis is True (which is the default),the <i>"axes"</i> value for this axis must be either <i>AXIS_IMPLIED_BY_ARGS</i> (the default)or <i>AXIS_REDUCED</i></dd>
<dt>"extends"</dt>
<dd>an N-tuple of six-tuples of pairs of integers (optional; the default is no extensions applied).Each six-tuple gives the (X,Y,Z,T,E,F) extension pairs for the corresponding argument.Each extension pair is the number of values to extend in the low and high indices of the axisbeyond that of the implied axis of the result. If a extension pair is None, no extensions are madefor that axis. If a six-tuple is None, no extensions are made for that argument.Thus, <i>(None, (None, None, None, (-1,1)), None)</i> me                                                                                                                                                                   
	NOTE: If an <i>"extends"</i> pair is given for an axis, the <i>"axes"</i> value for this axis mustbe <i>AXIS_IMPLIED_BY_ARGS</i> (the default value). The <i>"extends"</i> pair means more precisely that theaxis in the argument, exactly as provided in the Ferret command, is larger by the indicated amountfrom the implied axis of the result.</dd>
<dt>"piecemeal"</dt>
<dd>a six-tuple of booleans indicating whether the calculation can be broken up along the corresponding axisif necessary. In other words, if Ferret need to perform the calculation a piece at a time (probably due tomemory restrictions), this indicates which axes can split into pieces with separate calls on each pieceto perform the calculation. The default is False (no splitting allowed) for all axes.</dd>
</dl><p>
<a name="PYEFS_FERRET_COMPUTE" id="PYEFS_FERRET_COMPUTE"></a></p>
<h3>ferret_compute</h3>
<p>The ferret_compute function of a PyEF has the following signature:</p>
<dl><dt>ferret_compute(id, result, result_bad_flag, inputs, input_bad_flags)</dt>
</dl><p> </p>
<p>The arguments of the the function are:</p>
<p> </p>
<dl><dt>id</dt>
<dd>Ferret's identification number for this external function</dd>
<dt>result</dt>
<dd>a writeable NumPy array of six dimensions (X,Y,Z,T,E,F) to contain the results of this computation.The shape and strides of this array has been configured appropriately for this result.</dd>
<dt>result_bad_flag</dt>
<dd>a NumPy array of one dimension (and one value) containing the bad-data-flag value for the result array.(This bad-data-flag value is contained in a NumPy array to ensure the data type is identical to that of the result array.)</dd>
<dt>inputs</dt>
<dd>a tuple of read-only NumPy arrays of six dimensions (X,Y,Z,T,E,F) containing the given input data. The shapes and strides of these array have been configured appropriately for each input array.</dd>
<dt>input_bad_flags</dt>
<dd>a tuple of NumPy arrays of one dimension (each containing one value) containing the bad-data-flagvalue for each of the input arrays. (These bad-data-flag values are contained in a NumPy arrays to ensurethe data type is identical to that of the corresponding input array.)</dd>
</dl><p> </p>
<p>Any return value is ignored. If an error is identified, an exception should be raised with aninformative message (for example, <i>raise ValueError("The time axis is not a regularly-spaced axis")</i>). If an exception is raised, Ferret is notified that an error occurred. The message of the exceptionobject will be used as the error message sent to Ferret.</p>
<p>
<a name="PYEFS_FERRET_CUSTOM_AXES" id="PYEFS_FERRET_CUSTOM_AXES"></a></p>
<p> </p>
<h3>ferret_custom_axes</h3>
<p>The ferret_custom_axes function of a PyEF has the following signature:</p>
<dl><dt>ferret_custom_axes(id)</dt>
</dl><p>If the dictionary returned from <a href="#PYEFS_FERRET_INIT"><i>ferret_init</i></a> assigned a result axis as <i>AXIS_CUSTOM</i>, then the <i>ferret_custom_axes</i> function must also be defined. This function is used to defined all the axes that were designed as custom axes.</p>
<p> </p>
<p>The argument of the the function is:</p>
<p> </p>
<dl><dt>id</dt>
<dd>Ferret's identification number for this external function</dd>
</dl><p> </p>
<p>This function should return an (X, Y, Z, T, E, F) six-tuple of data values describing each of the custom axes. The data value for each custom axis is a (low, high, delta, unit_name, is_modulo) tuple where:</p>
<p> </p>
<dl><dt>low</dt>
<dd>the smallest "world" (floating-point) coordinates for this axis</dd>
<dt>high</dt>
<dd>the largest "world" (floating-point) coordinates for this axis</dd>
<dt>delta</dt>
<dd>the axis step increment in "world" (floating-point) coordinates for this axis</dd>
<dt>unit_name</dt>
<dd>a string used in describing the unit value of the "world" coordinates</dd>
<dt>is_modulo</dt>
<dd>indicates whether or not the axis is a modulo ("wrapping") axis</dd>
</dl><p>If an axis was not designated as <i>AXIS_CUSTOM</i>, then <i>None</i> should be given in the six-tuple for the data value for that axis.</p>
<p>
<a name="PYEFS_FERRET_RESULT_LIMITS" id="PYEFS_FERRET_RESULT_LIMITS"></a></p>
<h3>ferret_result_limits</h3>
<p>If the dictionary returned from <a href="#PYEFS_FERRET_INIT"><i>ferret_init</i></a> assigned a result axis as <i>AXIS_ABSTRACT</i>, then the <i>ferret_result_limits</i> function must also be defined. This function is used to defined all the axes that were designed as abstract axes.</p>
<p> </p>
<p>The ferret_result_limits function of a PyEF has the following signature:</p>
<p> </p>
<dl><dt>ferret_result_limits(id)</dt>
</dl><p> </p>
<p>The argument of the the function is:</p>
<p> </p>
<dl><dt>id</dt>
<dd>Ferret's identification number for this external function</dd>
</dl><p> </p>
<p>This function returns an (X, Y, Z, T, E, F) six-tuple of data values describing each of the abstract axes.The data value for each abstract axis is a (low, high) pairs of integers, which specify the low and highFerret indices for that axis. The indices for this axis in the result NumPy array to be assigned, however,will range from zero to (high - low).</p>
<p> </p>
<p>If an axis was not designated as <i>AXIS_ABSTRACT</i>, then <i>None</i> should be given in the six-tuple for the data value for that axis.</p>
<p> </p>
<p><a href="pyferret-python-objects.html">Previous</a> <a href="fortranefs.html">Next</a></p>
<p> </p>
</div>
</div>
</div>

</div>

<div class="clearfix">
<nav class="links node-links clearfix"></nav>

</div>
</article>
</div>
</div>
</div>      </div>
</div>  </div>
</div></section>    
 
<footer id="section-footer" class="section section-footer">

  <div id="zone-footer-wrapper" class="zone-wrapper zone-footer-wrapper clearfix">  
  <div id="zone-footer" class="zone zone-footer clearfix container-12">
    <div class="grid-8 region region-footer-first" id="region-footer-first">
  <div class="region-inner region-footer-first-inner">
    <div class="block block-block block-1 block-block-1 odd block-without-title" id="block-block-1">
  <div class="block-inner clearfix">
                
  </div>
</div><div class="block block-block block-2 block-block-2 even block-without-title" id="block-block-2">
  <div class="block-inner clearfix">
                
  </div>
</div><div class="block block-menu block-menu-footer-first-menu block-menu-menu-footer-first-menu odd block-without-title" id="block-menu-menu-footer-first-menu">

  </div>
</div>  </div>
</div><div class="grid-4 region region-footer-second" id="region-footer-second">
  <div class="region-inner region-footer-second-inner">
    <div class="block block-menu block-menu-footer-second-menu block-menu-menu-footer-second-menu odd block-without-title" id="block-menu-menu-footer-second-menu">
  <div class="block-inner clearfix">
                
  </div>
</div>  </div>
</div>  </div>
</div></footer>  </div>  <div class="region region-page-bottom" id="region-page-bottom">
  <div class="region-inner region-page-bottom-inner">
      </div>
</div>  <div id="body-bg-bottom"></div>
</body>
</html>

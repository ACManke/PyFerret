 
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML+RDFa 1.1//EN">
<html lang="en" dir="ltr" version="HTML+RDFa 1.1"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:dc="http://purl.org/dc/terms/"
xmlns:foaf="http://xmlns.com/foaf/0.1/"
xmlns:og="http://ogp.me/ns#"
xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
xmlns:sioc="http://rdfs.org/sioc/ns#"
xmlns:sioct="http://rdfs.org/sioc/types#"
xmlns:skos="http://www.w3.org/2004/02/skos/core#"
xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
xmlns:schema="http://schema.org/">
<head profile="http://www.w3.org/1999/xhtml/vocab">
<title>Outputting NetCDF? - Ferret/PyFerret FAQs</title>

<link rel="stylesheet" href="../modules/system/system.base.css">
<link rel="stylesheet" href="../modules/system/system.menus.css">
<link rel="stylesheet" href="../modules/system/system.messages.css">
<link rel="stylesheet" href="../modules/system/system.theme.css">

<link rel="stylesheet" href="../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.core.min.css">
<link rel="stylesheet" href="../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.theme.min.css">
<link rel="stylesheet" href="../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.menu.min.css">
<link rel="stylesheet" href="../sites/all/modules/jquery_update/replace/ui/themes/base/minified/jquery.ui.autocomplete.min.css">

<link rel="stylesheet" href="../sites/all/modules/calendar/css/calendar_multiday.css">
<link rel="stylesheet" href="../modules/field/theme/field.css">
<link rel="stylesheet" href="../sites/all/modules/scald/modules/fields/mee/css/editor-global.css">
<link rel="stylesheet" href="../modules/node/node.css">
<link rel="stylesheet" href="../sites/all/modules/scald_file/scald_file.css">
<link rel="stylesheet" href="../modules/search/search.css">
<link rel="stylesheet" href="../modules/user/user.css">
<link rel="stylesheet" href="../sites/all/modules/views/css/views.css">
<link rel="stylesheet" href="../sites/all/modules/ckeditor/css/ckeditor.css">

<link rel="stylesheet" href="../sites/all/modules/ctools/css/ctools.css">
<link rel="stylesheet" href="../sites/all/modules/custom_search/custom_search.css">
<link rel="stylesheet" href="../sites/all/modules/search_autocomplete/css/themes/minimal.css">
<link rel="stylesheet" href="../sites/all/libraries/superfish/css/superfish.css">
<link rel="stylesheet" href="../sites/all/libraries/superfish/css/superfish-smallscreen.css">
<link rel="stylesheet" href="../sites/all/libraries/superfish/css/superfish-vertical.css">

<link rel="stylesheet" href="../sites/all/themes/pacific_marine/css/ckeditor_custom.css">

<link rel="stylesheet" href="../sites/all/themes/omega/alpha/css/alpha-reset.css">
<link rel="stylesheet" href="../sites/all/themes/omega/alpha/css/alpha-mobile.css">
<link rel="stylesheet" href="../sites/all/themes/omega/alpha/css/alpha-alpha.css">
<link rel="stylesheet" href="../sites/all/themes/omega/omega/css/formalize.css">
<link rel="stylesheet" href="../sites/all/themes/omega/omega/css/omega-text.css">
<link rel="stylesheet" href="../sites/all/themes/omega/omega/css/omega-branding.css">
<link rel="stylesheet" href="../sites/all/themes/omega/omega/css/omega-menu.css">
<link rel="stylesheet" href="../sites/all/themes/omega/omega/css/omega-forms.css">
<link rel="stylesheet" href="../sites/all/themes/omega/omega/css/omega-visuals.css">
<link rel="stylesheet" href="../sites/all/themes/pacific_marine/css/global.css">



<link rel="stylesheet" href="../sites/all/themes/pacific_marine/css/pacific-marine-alpha-default.css">
<link rel="stylesheet" href="../sites/all/themes/pacific_marine/css/pacific-marine-alpha-default-wide.css">
<link rel="stylesheet" href="../sites/all/themes/omega/alpha/css/grid/alpha_default/wide/alpha-default-wide-12.css">


</head>
<body class="html not-front not-logged-in page-node page-node- page-node-555 node-type-documentation-page context-documentation">
  <div id="body-bg-top"></div>
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div class="page clearfix" id="page">
      <header id="section-header" class="section section-header">
  <div id="zone-header-wrapper" class="zone-wrapper zone-header-wrapper clearfix">  
  <div id="zone-header" class="zone zone-header clearfix container-12">
    <div class="grid-7 region region-branding" id="region-branding">
  <div class="region-inner region-branding-inner">
        <div class="branding-data clearfix">
            <div class="logo-img">
        <a href="../index.html" rel="home" title=""><img src="../sites/all/themes/pacific_marine/images/ferret-banner.png" alt="" id="logo" /></a>
		</div>
                </div>
          </div>
</div><div class="grid-5 region region-header-first" id="region-header-first">
  <div class="region-inner region-header-first-inner">
    <div class="block block-block block-4 block-block-4 odd block-without-title" id="block-block-4">
  <div class="block-inner clearfix">

  </div>
</div>
  </div>
</div>  </div>
</div>  </div>
</div><div id="zone-menu-wrapper" class="zone-wrapper zone-menu-wrapper clearfix">  
  <div id="zone-menu" class="zone zone-menu clearfix container-12">
    <div class="grid-12 region region-menu" id="region-menu">
  <div class="region-inner region-menu-inner">
        <div class="block block-system block-menu block-main-menu block-system-main-menu odd block-without-title" id="block-system-main-menu">
  <div class="block-inner clearfix">
                
    <div class="content clearfix">
      <ul class="menu">
	  <li class="first expanded"><a href="../index.html">Home</a>
	  <ul class="menu">
	  </li>
<li class="leaf"><a href="../index.html">Ferret/PyFerret Home</a></li>
</ul></li>
<li class="leaf"><a href="../documentation/ferret-documentation.html">Documentation</a></li>
<li class="leaf"><a href="ferret-faqs.html">FAQ</a></li>
<li class="collapsed"><a href="../documentation/pyferret/downloads.html">Downloads</a></li>
<li class="collapsed"><a href="../documentation/pyferret-support.html">Support</a></li>
</ul>    </div>
  </div>
</div>  </div>
</div>
  </div>
</div></header> 


      <section id="section-content" class="section section-content">
  <div id="zone-preface-wrapper" class="zone-wrapper zone-preface-wrapper clearfix">  
  <div id="zone-preface" class="zone zone-preface clearfix equal-height-container container-12">
    <div class="grid-3 region region-preface-first equal-height-element" id="region-preface-first">
  <div class="region-inner region-preface-first-inner">
      </div>
</div><div class="grid-9 region region-preface-second equal-height-element" id="region-preface-second">
  <div class="region-inner region-preface-second-inner">
      </div>
</div>  </div>
</div><div id="zone-content-wrapper" class="zone-wrapper zone-content-wrapper clearfix no-sidebar">  
  <div id="zone-content" class="zone zone-content clearfix equal-height-container container-12">    
        
        <div class="grid-12 region region-content equal-height-element" id="region-content">
  <div class="region-inner region-content-inner">
    <a id="main-content"></a>
            <div class="element-invisible">   
    </div>                    <div class="block block-system block-main block-system-main odd block-without-title" id="block-system-main">
  <div class="block-inner clearfix">
                
    <div class="content clearfix">
      <article about="/Ferret/index.html" typeof="foaf:Document" class="node node-page node-published node-not-promoted node-not-sticky author-burger odd clearfix" id="node-page-771">

<h2 class="block-title"><a href="ferret-faqs.html" class="active-trail">FAQ</a></h2>
<a id="main-content"></a>
<div class="element-invisible">    <h1 class="title" id="page-title">Outputting NetCDF?</h1>
</div>                    <div class="block block-system block-main block-system-main odd block-without-title" id="block-system-main">
<div class="block-inner clearfix">
 
<div class="content clearfix">
<article about="/Ferret/faq/outputting-netcdf" typeof="foaf:Document" class="node node-page node-published node-not-promoted node-not-sticky author-ansley odd clearfix" id="node-page-684">

<h1 id="page title"  class="node-title">Outputting NetCDF?</h1>  <div class="content clearfix">
 
<div class="field field-name-body field-type-text-with-summary field-label-hidden">
<div class="field-items">
<div class="field-item even" property="content:encoded"><h2>Question:</h2>
<blockquote><p>How do I make my model write out NetCDF files that are suitable for Ferret?</p>
</blockquote>
<h2>Solution:</h2>
<p>You can get the NetCDF libraries from Unidata at <a href="http://www.unidata.ucar.edu/software/netcdf">http://www.unidata.ucar.edu/software/netcdf&gt;</a>, link your software to the libraries, and make calls to the NetCDF library to open a dataset, define variables, and write data to the file. Below is a second way, using the NetCDF tools ncdump and ncgen:</p>
<p>The NetCDF utilities ncgen and ncdump do most of the work for you. They actually generate the FORTRAN or C code that you will need. All you have to do is to "hack it" a little bit.</p>
<p>You can use Ferret commands to describe what your output files should look like -- everything about the output files except the actual data and time word values.</p>
<p>We proceed in 4 steps:</p>
<ol><li>describe the file using Ferret commands</li>
<li>use ncdump to create a "CDL" language description of the file</li>
<li>use ncgen to generate FORTRAN or C code</li>
<li>hack that code and insert it into our model code</li>
</ol><p><b>1. Describe the file using Ferret commands</b></p>
<p>For this example let us suppose that we will have variables U and TEMP and that they are on staggered grids.</p>
<p>We will define variables like this with Ferret commands. The **values** of these variables will never be used ... but the **shape** of the variables is important. Our example doesn't use a Z axis but it could be added in a straightforward way.</p>
<p>The encoding of time is discussed at some length in the Ferret Users Guide</p>
<pre>
! define the axes and grids
! temperature axes
define axis/x=130e:80w:2/unit="degrees" xt
define axis/y=20s:20n:2/unit="degrees" yt
 
! velocity axes (staggered relative to temperature)
define axis/x=131e:79w:2/unit="degrees" xu
define axis/y=19s:21n:2/unit="degrees" yu
 
! time axis
define axis/t="1-jan-1980:12:00":"1-jan-1990:12:00":1/unit="days" time
! define the grids
define grid/x=xt/y=yt/t=time gt
define grid/x=xu/y=yu/t=time gu
 
! define the (dummy) variables
let u = SIN((x[g=gu]+y[g=gu]+t[g=gu])/100)
let temp = SIN((x[g=gt]+y[g=gt]+t[g=gt])/100)
set variable/title="Temperature"/units="centigrade" temp
set variable/title="Zonal Velocity"/units="m/sec" u
 
! create the template NetCDF file
save/file=template.cdf/l=1 temp,u
</pre><p><b>2. Now create a CDL description of this file</b></p>
<pre>
! ... note -- you can edit template.cdl with your favorite editor
 
&gt; ncdump template.cdf &gt; template.cdl
</pre><p><b>3. now create FORTRAN code that would generate this NetCDF file</b></p>
<p>( use the "-c" qualifier instead of "-f" to get C code)</p>
<pre>
! ... note: you can "hack" this FORTRAN code to create the NetCDF output
! parts of your model
 
&gt; ncgen -f template.cdl &gt; template.F
</pre><p><b>4. Hack the code from template.F into your model code</b></p>
<p>Usually you will</p>
<ol><li>create a subroutine to create (but not insert data into) the output file. It is executed only once.</li>
<li>insert the NetCDF into your model code where you want to write out the time word and the values of your variables. It is executed once per output time step of your model</li>
</ol><p> </p>
<ol><li>The subroutine to create the output file is the FORTRAN code from the line<br /><pre>
include 'netcdf.inc'
</pre><p>	through</p>
<pre>
* leave define mode
call ncendf(ncid, iret)
</pre><p>You will also want the blocks of code like <i>store XT</i> that write your models coordinate system into the output file.</p>
<p><b>Note:</b> For maximum accuracy you may want to write the coordinates directly from your model arrays instead of from the DATA statement. For this make sure youinsert the matching data type (e.g. "NCDOUBLE") in the <i>define </i><i>variables</i> section of the file creation code.</p>
<p> </p>
</li>
<li>The code to write the time word is hacked from <i>store TIME</i>. Note that the"corner" value will be "1" for time step 1, 2 for step 2, etc.As with the other coordinates make the data type of your model time word variable matches the data type specified during <i>define variables</i>
<p>The code will look something like</p>
<pre>
corner(1) = istep ! the current output time step
edges(1) = 1
call ncvpt(ncid, TIMEid, corner, edges, time_word, iret)
</pre><p>The code to write the model variables is similar:</p>
<pre>
! corner is the start point for writing -- normally "1" on each axis
! edges is the amount to write for each axis -- normally the full axis length
 
corner(1) = 1
corner(2) = 1
corner(3) = istep
edges(1) = 76
edges(2) = 21
edges(3) = 1
 
call ncvpt(ncid, TEMPid, corner, edges, temp_var, iret)
 
</pre><p> </p>
</li>
</ol><p> </p>
<hr /><p><i>Last modified: Dec 9, 1996</i></p>
</div>
</div>
</div>

</div>

<div class="clearfix">
<nav class="links node-links clearfix"></nav>

</div>
</article>    </div>
</div>
</div>      </div>
</div>  </div>
</div></section>    
 
<footer id="section-footer" class="section section-footer">

  <div id="zone-footer-wrapper" class="zone-wrapper zone-footer-wrapper clearfix">  
  <div id="zone-footer" class="zone zone-footer clearfix container-12">
    <div class="grid-8 region region-footer-first" id="region-footer-first">
  <div class="region-inner region-footer-first-inner">
    <div class="block block-block block-1 block-block-1 odd block-without-title" id="block-block-1">
  <div class="block-inner clearfix">
                
  </div>
</div><div class="block block-block block-2 block-block-2 even block-without-title" id="block-block-2">
  <div class="block-inner clearfix">
                
  </div>
</div><div class="block block-menu block-menu-footer-first-menu block-menu-menu-footer-first-menu odd block-without-title" id="block-menu-menu-footer-first-menu">

  </div>
</div>  </div>
</div><div class="grid-4 region region-footer-second" id="region-footer-second">
  <div class="region-inner region-footer-second-inner">
    <div class="block block-menu block-menu-footer-second-menu block-menu-menu-footer-second-menu odd block-without-title" id="block-menu-menu-footer-second-menu">
  <div class="block-inner clearfix">
                
  </div>
</div>  </div>
</div>  </div>
</div></footer>  </div>  <div class="region region-page-bottom" id="region-page-bottom">
  <div class="region-inner region-page-bottom-inner">
      </div>
</div>  <div id="body-bg-bottom"></div>
</body>
</html>
